/*!
 * LastModifyTime: Thu Aug 06 2015 22:40:04 GMT+0800 (CST)
 * Process
 * Copyright(c) 2015 Jade Gu <guyingjie129@163.com>
 * MIT Licensed
 */
 !function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&(define.amd||define.cmd)?define(r):"object"==typeof exports?exports.Process=r():t.Process=r()}(this,function(){function t(t,r){this.store=c({},t),this.state=c({},r)}var r=function(t){return function(r){return null!=r?Object.prototype.toString.call(r)==="[object "+t+"]":!1}},e=r("Object"),n=r("String"),i=r("Function"),o=Array.isArray||r("Array"),s=function(t){return null!=t&&i(t.then)},u=Array.prototype.slice,c=function(t){for(var r=u.call(arguments,1),n=0,o=r.length;o>n;n+=1){var s=r[n];if(e(s)||i(s))for(var c in s)s.hasOwnProperty(c)&&(t[c]=s[c])}return t};return t.prototype={extend:function(){return c.apply(null,[this.store].concat(u.call(arguments)))},setState:function(){return c.apply(null,[this.state].concat(u.call(arguments)))},resolve:function(t,r){return this.dispatch(this.store[t],r)},reject:function(r,n){return this.error||(this.error=new t),e(this.store.error)&&this.error.extend(this.store.error),this.error.resolve(r,n)},willResolve:function(t){var r=this;return function(e){return r.resolve(t,e)}},willReject:function(t){var r=this;return function(e){return r.reject(t,e)}},dispatch:function(t,r){if(i(t))return t.call(this,r,this.state);if(n(t))return this.dispatch(this.store[t],r);if(o(t)&&t.length)return this.pipe(t,r);if(s(t)){var u=this;return t.then(function(t){return u.dispatch(t,r)})}return e(t)?this.transform(t,r):r},pipe:function(t,r){for(var e=this,n=0,i=t.length;i>n;n+=1){if(r=this.dispatch(t[n],r),s(r))return n===i-1?r:r.then(function(r){return e.pipe(t.slice(n+1),r)});if(null===r)return null}return r},transform:function(t,r){return i(t.goTo)?this.dispatch(t.goTo(r,this.state),r):r}},t});