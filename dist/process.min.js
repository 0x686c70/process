!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&(define.amd||define.cmd)?define(r):"object"==typeof exports?exports.Process=r():t.Process=r()}(this,function(){function t(t,r){this.store=u({},t),this.state=u({},r)}var r=function(t){return function(r){return null!=r?Object.prototype.toString.call(r)==="[object "+t+"]":!1}},e=r("Object"),n=r("String"),o=r("Function"),i=Array.isArray||r("Array"),s=function(t){return null!=t&&o(t.then)},u=function(t){for(var r=Array.prototype.slice.call(arguments,1),n=0,i=r.length;i>n;n+=1){var s=r[n];if(e(s)||o(s))for(var u in s)s.hasOwnProperty(u)&&(t[u]=s[u])}return t};return t.prototype={extend:function(){return u.apply(null,[this.store].concat(Array.prototype.slice.call(arguments)))},resolve:function(t,r){return this.dispatch(this.store[t],r)},reject:function(r,n){return this.error||(this.error=new t),e(this.store.error)&&this.error.extend(this.store.error),this.error.resolve(r,n)},willResolve:function(t){var r=this;return function(e){return r.resolve(t,e)}},willReject:function(t){var r=this;return function(e){return r.reject(t,e)}},dispatch:function(t,r){if(o(t))return t.call(this,r,this.state);if(n(t))return this.resolve(t,r);if(i(t))return this.pipe(t,r);if(s(t)){var u=this;return t.then(function(t){return u.dispatch(t,r)})}return e(t)?this.transform(t,r):r},pipe:function(t,r){for(var e=0,n=t.length;n>e;e+=1){if(r=this.dispatch(t[e],r),s(r)){var o=this;return r.then(function(r){return o.pipe(t.slice(e+1),r)})}if(null===r)return null}return r},transform:function(t,r){return o(t.goTo)?this.dispatch(t.goTo(r),r):r}},t});