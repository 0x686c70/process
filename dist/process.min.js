/*!
 * LastModifyTime: Sat Aug 08 2015 16:59:27 GMT+0800 (CST)
 * Process.js Version: 0.0.6
 * Github:https://github.com/Lucifier129/process
 * Copyright(c) 2015 Jade Gu <guyingjie129@163.com>
 * MIT Licensed
 */
!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&(define.amd||define.cmd)?define(r):"object"==typeof exports?exports.Process=r():t.Process=r()}(this,function(){function t(t,r){this.store=f({},t),this.state=f({},r)}var r=function(t){return t="[object "+t+"]",function(r){return null!=r&&Object.prototype.toString.call(r)===t}},e=r("Object"),n=r("String"),o=r("Number"),i=r("Function"),u=Array.isArray||r("Array"),s=function(t){return null!=t&&i(t.then)},c=Array.prototype.slice,f=function(t){for(var r=c.call(arguments,1),n=0,o=r.length;o>n;n++){var i=r[n];if(e(i))for(var u in i)i.hasOwnProperty(u)&&(t[u]=i[u])}return t};return t.prototype={extend:function(){return f.apply(null,[this.store].concat(c.call(arguments)))},setState:function(){return f.apply(null,[this.state].concat(c.call(arguments)))},resolve:function(t,r){return this.dispatch(this.store[t],r)},reject:function(r,n){var o=this.store.error;return this.error instanceof t?e(o)&&this.error.extend(o):this.error=new t(o),this.error.resolve(r,n)},willResolve:function(t){var r=this;return function(e){return r.resolve(t,e)}},willReject:function(t){var r=this;return function(e){return r.reject(t,e)}},dispatch:function(t,r){if(null===r)return r;var c=this;if(i(t))return t(r,c.state,c);if(n(t)||o(t))return c.dispatch(c.store[t],r);if(u(t))for(var f=0,a=t.length;a>f;f++){if(r=c.dispatch(t[f],r),null===r)return r;if(s(r))return f===a-1?r:r.then(function(r){return c.dispatch(t.slice(f+1),r)})}else{if(s(t))return t.then(function(t){return c.dispatch(t,r)});if(e(t)&&i(t.goTo))return c.dispatch(t.goTo(r,c.state,c),r)}return r}},t});