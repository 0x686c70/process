/*!
 * LastModifyTime: 2015-08-07 11:00:07
 * Process * Copyright(c) 2015 Jade Gu <guyingjie129@163.com>
 * MIT Licensed
 */
!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&(define.amd||define.cmd)?define(r):"object"==typeof exports?exports.Process=r():t.Process=r()}(this,function(){function t(t,r){this.store=l({},t),this.state=l({},r)}var r=function(t){return t="[object "+t+"]",function(r){return null!=r&&Object.prototype.toString.call(r)===t}},e=r("Object"),n=r("String"),o=r("Number"),i=r("Function"),u=Array.isArray||r("Array"),s=function(t){return null!=t&&i(t.then)},c=Array.prototype.slice,l=function(t){for(var r=c.call(arguments,1),n=0,o=r.length;o>n;n+=1){var i=r[n];if(e(i))for(var u in i)i.hasOwnProperty(u)&&(t[u]=i[u])}return t};return t.prototype={extend:function(){return l.apply(null,[this.store].concat(c.call(arguments)))},setState:function(){return l.apply(null,[this.state].concat(c.call(arguments)))},resolve:function(t,r){return this.dispatch(this.store[t],r)},reject:function(r,n){var o=this.store.error;return this.error?e(o)&&this.error.extend(o):this.error=new t(o),this.error.resolve(r,n)},willResolve:function(t){var r=this;return function(e){return r.resolve(t,e)}},willReject:function(t){var r=this;return function(e){return r.reject(t,e)}},dispatch:function(t,r){var c=this;return i(t)?t.call(c,r,c.state):n(t)||o(t)?c.dispatch(c.store[t],r):u(t)?t.length?c.pipe(t,r):r:s(t)?t.then(function(t){return c.dispatch(t,r)}):e(t)&&i(t.goTo)?c.dispatch(t.goTo(r,c.state),r):r},pipe:function(t,r){for(var e=this,n=0,o=t.length;o>n;n+=1){if(r=e.dispatch(t[n],r),s(r))return n===o-1?r:r.then(function(r){return e.pipe(t.slice(n+1),r)});if(null===r)return null}return r}},t});